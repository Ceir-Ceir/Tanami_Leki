generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model events {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  anonymous_id String?
  email        String?
  event_type   String?
  points       Int?
  metadata     Json?
  created_at   DateTime? @default(now()) @db.Timestamptz(6)
  page_url     String?
  page_path    String?
  referrer     String?
  utm_source   String?
  utm_medium   String?
  utm_campaign String?
  utm_term     String?
  utm_content  String?
}

model kb_chunks {
  id           String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  document_id  String                 @db.Uuid
  chunk_index  Int
  content      String
  metadata     Json                   @default("{}")
  embedding    Unsupported("vector")?
  created_at   DateTime               @default(now()) @db.Timestamptz(6)
  kb_documents kb_documents           @relation(fields: [document_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([document_id, chunk_index])
  @@index([embedding])
}

model kb_documents {
  id          String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title       String
  source_url  String?
  source_type String?     @default("other")
  enabled     Boolean     @default(true)
  created_at  DateTime    @default(now()) @db.Timestamptz(6)
  updated_at  DateTime    @default(now()) @db.Timestamptz(6)
  kb_chunks   kb_chunks[]
}

model leads {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  anonymous_id String?
  email        String?
  lead_score   Int?      @default(0)
  stage        String?   @default("VISITOR")
  first_seen   DateTime? @default(now()) @db.Timestamptz(6)
  last_seen    DateTime? @default(now()) @db.Timestamptz(6)
  session_id   String?
  utm_source   String?
  utm_medium   String?
  utm_campaign String?
  referrer     String?
}

model sessions {
  session_id   String   @id
  first_seen   DateTime @default(now()) @db.Timestamptz(6)
  last_seen    DateTime @default(now()) @db.Timestamptz(6)
  duration_ms  BigInt   @default(0)
  referrer     String?
  utm_source   String?
  utm_medium   String?
  utm_campaign String?
  utm_term     String?
  utm_content  String?
  email        String?
}

model Session {
  id            String    @id
  shop          String
  state         String
  isOnline      Boolean   @default(false)
  scope         String?
  expires       DateTime?
  accessToken   String
  userId        BigInt?
  firstName     String?
  lastName      String?
  email         String?
  accountOwner  Boolean   @default(false)
  locale        String?
  collaborator  Boolean?  @default(false)
  emailVerified Boolean?  @default(false)
  refreshToken  String?
  refreshTokenExpires DateTime?
}
